version: 0.2

phases:
  build:
    commands:
      - echo "Fetching AWS account and region..."
      - ACCOUNT_ID=$(aws sts get-caller-identity --query "Account" --output text)
      - REGION=$(aws configure get region)
      - BUCKET_NAME="signin-frontend-${ACCOUNT_ID}-${REGION}"
      - echo "Using bucket name- $BUCKET_NAME"
      - echo "Deploying CloudFormation stack for signin-frontend..."
      - |
        aws cloudformation deploy \
          --template-file signin-frontend-stack.yaml \
          --stack-name signin-frontend-stack \
          --capabilities CAPABILITY_NAMED_IAM \
          --parameter-overrides BucketName=$BUCKET_NAME

  post_build:
    commands:
      - echo "Stack deployment complete."
      - |
        aws cloudformation describe-stacks \
          --stack-name signin-frontend-stack \
          --query "Stacks[0].Outputs" \
          --output table
